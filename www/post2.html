<!DOCTYPE html>
<html>
<head>
<title>Roadkill Report</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="./css/jquery.mobile-1.4.3.css">
<script src="./js/jquery-1.11.1.min.js"></script>
<script src="./js/jquery.mobile-1.4.3.js"></script>
<link rel="stylesheet" media="screen" href="./assets/css/home.css">
<link rel="stylesheet" media="all" href="./assets/css/application.css">
<script src="./assets/js/application.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?language=zh-TW"></script>
<script src="./assets/js/binaryajax.js"></script>
<script src="./assets/js/exif.js"></script>
<link rel="stylesheet" media="screen" href="./assets/css/jtsage/jqm-datebox-1.4.2.css">
<script src="./assets/js/jtsage/jqm-datebox-1.4.2.core.js"></script>
<script src="./assets/js/jtsage/jqm-datebox-1.4.2.mode.calbox.js"></script>
<script src="./assets/js/jtsage/jqm-datebox-1.4.2.mode.datebox.js"></script>
<script src="./assets/js/jtsage/jquery.mobile.datebox.i18n.zh-TW.utf8.js"></script>
<script src="./js/auth.js"></script>
<script src="cordova.js"></script>
<script src="./assets/js/home.js"></script>
</head>

<body>

<div id="loginPage" data-role="page">
    <div data-role="header" class="ui-header" data-theme="b">
        <h1>Roadkill Report!</h1>
    </div>
    <div data-role="main" class="ui-content" data-theme="a">
        <img src="./img/logo.jpg" style="display: block; max-width: 70%; margin: auto;" />
        <div class="ui-field-contain">
            <form method="post">
                <input type="text" id="username" placeholder="Username"/>
                <input type="password" id="password" placeholder="Password"/>
                <br />
                <input type="submit" value="Login" id="login" data-icon="carat-r" data-iconpos="right" />
            </form>
        </div>
    </div>
</div> <!--login-->

<div id="home" data-role="page">
    <div data-role="header" class="ui-header" data-theme="b">
        <div role="navigation" class="ui-navbar" data-role="navbar">
            <ul class="ui-grid-b">
                <li class="ui-block-a"><a class="ui-link ui-btn ui-icon-grid ui-btn-icon-top" href="#" data-icon="grid">檢視</a></li>
                <li class="ui-block-b"><a class="ui-link ui-btn ui-icon-star ui-btn-icon-top" href="#" data-transition="slide" data-icon="star">回報</a></li>
                <li class="ui-block-c"><a class="ui-link ui-btn ui-icon-gear ui-btn-icon-top" href="#panelSetting" data-transition="slide" data-icon="gear">設定</a></li>
            </ul>
        </div>
    </div>
    <div data-role="main" class="ui-content" data-theme="a">
        <ul data-role="listview" data-split-theme="a" data-inset="true" >
            <li id="eventRow" data-icon="edit">
                <a href="#" data-rel="popup" data-position-to="window" data-transition="fade">
                    <img src="./assets/img/camera.png" id="photo" class="minor-padding vcenter photo" alt="照片">
                    <textarea id="photoDesc" class="simple-border photoDesc" placeholder="照片說明"></textarea>
                    <div><p class="location"></p></div>
                </a>
                <a id="btnEdit" href="#" class="btnEdit" data-rel="popup" data-position-to="window" data-transition="pop">編輯</a>
                <div style="width: 0; height: 0; overflow: hidden;">
                    <input id="photoPicker" class="photoPicker" type="file" accept="image/*" capture="camera">
                </div>
            </li>
        </ul>
        <div id="bottomContainer">
            <button id="drupalBtn" class="btn btn-block" onclick="logoutDrupal()">Logout</button>
        </div>
    </div>
    
    <div id="homeToolbar" data-role="footer" data-position="fixed" data-tap-toggle="false" style="padding: 5px 0 5px 0">
        <div class="text-center" style="margin: 0 50% 0 50%;">
            <a id="btnUpload" href="#" class="ui-btn ui-btn-a ui-btn-inline ui-corner-all ui-shadow rounded-corner pastel-blue" style="padding: 20px 50px 20px 50px; margin: 0 -64px;">上傳</a>
        </div>
    </div>

    <!-- popups -->
    
    <div id="panelSetting" class="ui-panel ui-panel-position-right ui-panel-display-overlay ui-body-a ui-panel-animate ui-panel-closed" data-role="panel" data-position="right" data-display="overlay" data-dismissible="true" data-theme="a">
        <label for="select-cc" class="select">我的內容授權為…</label>
        <select name="select-cc" id="select-cc">
            <option value="0">版權所有</option>
            <option value="1">無版權</option>
            <option value="2">CC0</option>
            <option value="3" selected>BY (姓名標示)</option>
            <option value="4">BY-NC (姓名標示─非商業性)</option>
            <option value="5">BY-NC-SA (姓名標示─非商業性─相同方式分享)</option>
            <option value="6">BY-ND (姓名標示─禁止改作)</option>
            <option value="7">BY-NC-ND (姓名標示─非商業性─禁止改作)</option>
            <option value="8">BY-SA (姓名標示─相同方式分享)</option>
        </select>
        <label for="select-fbId" class="select">在路殺社臉書社團…</label>
        <select name="select-fbId" id="select-fbId">
            <option value="0">具名發佈</option>
            <option value="1">公用帳號發佈</option>
            <option value="2">不公開發佈</option>
        </select>
    </div><!-- /panel -->

    <!-- popups -->
    
    <div id="editPopup" data-role="popup" data-theme="a" data-overlay-theme="b" class="ui-content" style="max-width:340px; padding: 35px;">
        <p style="text-align: center" >對這個事件，你要...</p>
        <ul data-role="listview" data-inset="true">
            <li><a id="btnRetakePhoto" href="#">重拍一張照片</a></li>
            <li><a id="btnUpdateLocation" href="#">標記日期與地點</a></li>
        </ul>
    </div>
    <div id="imgPopup" data-role="popup" data-theme="a" data-overlay-theme="b" class="ui-content" style="max-width:340px; padding: 35px;">
            <ul data-role="listview" data-inset="true">
                <li><a id="CAMERA" class="ui-btn ui-icon-camera ui-btn-icon-left" href="#">拍攝新的照片</a></li>
                <li><a id="PHOTOLIBRARY" class="ui-btn ui-icon-grid ui-btn-icon-left" href="#">從相簿中選取</a></li>
            </ul>
    </div>

</div>

<div id="map" data-role="page">
    <div data-role="main" class="ui-content" data-theme="a" style="padding:0;">
        <div id="gmapCanvas" style="width:100%;"></div>
    </div>
    <div id="mapToolbar" data-role="footer" data-position="fixed" data-tap-toggle="false" style="padding: 5px 0 5px 0">
        <div><p id="selectedMapLocation" class="text-center"></p></div>
        <div><p id="selectedDate" class="text-center"></p></div>
        <div style="display: none;">
            <input id="datePicker" type="date" data-role="datebox" data-options='{"mode": "calbox", "overrideDateFormat": "%Y/%m/%d", "beforeToday": true}'>
        </div>
        <div class="text-center" data-role="controlgroup" data-type="horizontal" style="padding: 10px 0 10px 0;">
            <a id="btnConfirmLocation" href="#" class="ui-btn ui-corner-all ui-btn-icon-bottom ui-icon-check horizontal-controlgroup-large">確定</a>
            <a id="btnPickDateTime" href="#" class="ui-btn ui-corner-all ui-btn-icon-bottom ui-icon-calendar horizontal-controlgroup-large">日期</a>
            <a id="btnCancelMapView" href="#" class="ui-btn ui-corner-all ui-btn-icon-bottom ui-icon-delete horizontal-controlgroup-large">取消</a>
        </div>
    </div>
</div>

<script>
    // A button will call this function
    var triggerDrupalBtn = function(reset) {
        if(this.login || reset) {
            $('#drupalBtn').html('Login drupal');
            $('#drupalBtn').attr('onclick', 'loginDrupal()');
        } else {
            $('#drupalBtn').html('Logout drupal');
            $('#drupalBtn').attr('onclick', 'logoutDrupal()');
        }
        this.login = !this.login;
    }
    var onLogin = function(result) {
        if(result === "success") {
            document.location.href = '#home';
        }
    }
    var onLogout = function(result) {
        if(result === "success") {
            document.location.href = '#loginPage';
        }
    }
    var onFail = function(message) {
        alert('Failed because: ' + message);
        //triggerDrupalBtn(true);
    }
    function loginDrupal(e){
        e.preventDefault();
        if(!rkAuth.isOnline()) {
            alert('no connection');
            return;
        }
        rkAuth.loginDrupal($('#username').val(), $('#password').val(), onLogin, onFail);
    }
    function logoutDrupal() {
        rkAuth.logoutDrupal(onLogout, onFail);
    }
    
    window.addEventListener('online', function(event) {
        if(rkAuth.hasAuth()) {
            document.location.href = '#home';
        }
    }, false);
    $(document).on("pagecreate","#loginPage", function(event) {
        $('#login').click(loginDrupal);
    });


</script>

</body>
</html>

